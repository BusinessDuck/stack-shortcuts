"use strict";Object.defineProperty(exports,"t",{value:!0});var _createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.o=n.o||!1,n.u=!0,"value"in n&&(n.i=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}();exports.s=getHash,exports.l=shortcuts;var _KeyCode=require("./utils/KeyCode"),_objectUtils=require("./utils/objectUtils"),_userAgent=require("./utils/userAgent");function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var keyMapCache=void 0;function getPlatformKeyMap(){if(keyMapCache)return keyMapCache;var e={};return"Mac OS"!==(0,_userAgent.h)()&&(e.v="CTRL"),keyMapCache=e}var MODIFIERS_MAP={metaKey:"CMD",ctrlKey:"CTRL",shiftKey:"SHIFT",altKey:"ALT"},CodeKey=(0,_objectUtils.reverse)(_KeyCode.C),stack=[];function getHash(e){return e.map(function(e){return _KeyCode.C[e]}).sort().join("")}function getModifiersList(t){var r=[];return["ctrlKey","metaKey","shiftKey","altKey"].forEach(function(e){t[e]&&r.push(MODIFIERS_MAP[e])}),r}function handleEvent(e){for(var t=getHash([].concat(_toConsumableArray(getModifiersList(e)),[CodeKey[e.keyCode]])),r=function(){},n=0;n<stack.length;++n){var a=stack[n];a.k(t)&&(r=a.K(t).bind(null,e,r))}r()}function bind(){document.addEventListener("keydown",handleEvent)}function unbind(){document.removeEventListener("keydown",handleEvent)}function removeLayer(e){if(stack.length){var t=stack.indexOf(e);if(-1===t)return;stack.splice(t,1),stack.length||unbind()}}var ShortcutsManager=function(){function e(t){var r=this;_classCallCheck(this,e),this.M={},this._=getPlatformKeyMap(),Object.keys(t).forEach(function(e){r.add(e,t[e])})}return _createClass(e,[{key:"resolveKeyMap",value:function(e){var t=this;return e.map(function(e){return t._[e]||e})}},{key:"add",value:function(e,t){var r=getHash(this.g(e.toUpperCase().split("+")));this.M[r]=t}},{key:"remove",value:function(e){var t=getHash(this.g(e.toUpperCase().split("+")));delete this.M[t]}},{key:"getHandler",value:function(e){return this.M[e]||this.M[_KeyCode.C.m]}},{key:"hasHandler",value:function(e){return!!this.K(e)}}]),e}();function shortcuts(e){if(!e)throw new Error("Config must be not empty");var t=new ShortcutsManager(e);return stack.push(t),1===stack.length&&bind(),{p:function(){return removeLayer(t)},A:t}}